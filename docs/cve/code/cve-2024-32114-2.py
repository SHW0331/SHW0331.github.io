import requests

# Jolokia JMX API를 통해 브로커의 전체 구조 가져오기
def get_broker_structure(jolokia_url):
    try:
        response = requests.get(f"{jolokia_url}/api/jolokia/read/org.apache.activemq:brokerName=localhost,type=Broker")
        if response.status_code == 200:
            data = response.json()
            return data
        else:
            print("Failed to get broker structure:", response.status_code)
            print(response.text)  # 응답 본문 출력
            return None
    except Exception as e:
        print("Error while getting broker structure:", e)
        return None

# 메인 함수
def main():
    # Apache ActiveMQ가 동작하는 서버의 주소
    jolokia_url = "http://192.168.56.1:8161"
        
    # 브로커의 전체 구조 가져오기
    broker_structure = get_broker_structure(jolokia_url)
    if broker_structure:
        print("Broker Structure:", broker_structure)
    else:
        print("Failed to retrieve broker structure")

if __name__ == "__main__":
    main()
