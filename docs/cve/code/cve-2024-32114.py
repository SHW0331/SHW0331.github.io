import requests
import time

# Message REST API를 통해 메시지 전송
def send_message(message_api_url, destination, message):
    try:
        headers = {'Content-Type': 'application/json'}
        data = {
            "type": "queue",
            "destinationName": destination,
            "body": message,
        }
        response = requests.post(f"{message_api_url}/api/message?type=queue&destination={destination}", json=data, headers=headers)
        if response.status_code == 204:
            print("Message sent successfully")
        else:
            print("Failed to send message:", response.status_code, response.text)
    except Exception as e:
        print("Error while sending message:", e)

# Message REST API를 통해 메시지 수신
def receive_message(message_api_url, destination):
    try:
        headers = {'Accept': 'application/json'}
        response = requests.get(f"{message_api_url}/api/message?type=queue&destination={destination}&oneShot=true", headers=headers)
        if response.status_code == 200:
            messages = response.json()
            if isinstance(messages, list):
                for message in messages:
                    print("Received message:", message['text'])
            else:
                print("Received message:", messages)
        else:
            print("Failed to receive message:", response.status_code, response.text)
    except Exception as e:
        print("Error while receiving message:", e)

# 메인 함수
def main():
    # Apache ActiveMQ가 동작하는 서버의 주소
    message_api_url = "http://192.168.56.1:8161"
    
    # 메시지 전송
    destination = "testQueue"
    message = "Hello, ActiveMQ!"
    send_message(message_api_url, destination, message)
    
    # 메시지 수신 (잠시 대기 후)
    time.sleep(2)
    receive_message(message_api_url, destination)

if __name__ == "__main__":
    main()
